<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>iPaiPai - 专注于约拍的网站</title>
        <link rel="stylesheet" href="css/uikit.min.css"/>
        <link rel="stylesheet" href="css/index.css"/>

        <script src="js/lib/jquery-3.2.1.min.js"></script>
        <script src="js/lib/uikit.min.js"></script>
        <script src="js/lib/uikit-icons.min.js"></script>
        <script src="js/util/cookie.js"></script>
        <script src="js/util/url.js"></script>
        <script src="js/util/notification.js"></script>
    </head>
    <body class="uk-background-cover uk-position-relative uk-offcanvas-content">
        <div class="uk-position-center">
            <h1 class="uk-heading-primary uk-text-bold uk-margin-medium-bottom uk-text-center uk-flex-middle uk-animation-slide-top"> 嗨！爱拍吗</h1>
            <div class="uk-width-auto">
                <div class="uk-position-bottom-center uk-position-relative">
                    <button class="uk-button-large uk-button-secondary uk-animation-slide-bottom" uk-toggle="target: #signCanvas"> 进去看看!</button>
                </div>
            </div>
        </div>
        <div class="uk-light uk-position-bottom-center uk-position-medium">
            <ul class="uk-dotnav">
                <li class="uk-active"><a></a></li>
                <li><a></a></li>
                <li><a></a></li>
                <li><a></a></li>
                <li><a></a></li>
                <li><a></a></li>
            </ul>
        </div>
        <div id="signCanvas" uk-offcanvas="flip: true">
            <div class="uk-offcanvas-bar">

                <button class="uk-offcanvas-close" type="button" uk-close></button>

                <h2 class="uk-margin">欢迎！</h2>

                <form id="signInForm">
                    <fieldset class="uk-fieldset">
                        <legend class="uk-legend">登录</legend>
                        <div class="uk-margin">
                            <input id="signInUsername" class="uk-input" type="text" placeholder="用户名"/>
                        </div>
                        <div class="uk-margin">
                            <input id="signInPassword" class="uk-input" type="password" placeholder="密码"/>
                        </div>
                        <button id="signInBtn" class="uk-form-width-medium uk-button-default uk-button">登录</button>
                    </fieldset>
                    <div class="uk-margin">
                        还没有账号？点<a id="toSignUpLink">这里</a>!
                    </div>
                </form>

                <form id="signUpForm">
                    <fieldset class="uk-fieldset">
                        <legend class="uk-legend">注册</legend>
                        <div class="uk-margin">
                            <input id="signUpUsername" class="uk-input" type="text" placeholder="用户名（6~14个字符）"/>
                        </div>
                        <div class="uk-margin">
                            <input id="signUpPhone" class="uk-input" type="text" placeholder="手机号"/>
                        </div>
                        <div class="uk-margin">
                            <input id="signUpNickname" class="uk-input" type="text" placeholder="昵称（1~12个字符）"/>
                        </div>
                        <div class="uk-margin">
                            <input id="signUpPassword" class="uk-input" type="password" placeholder="密码"/>
                        </div>
                        <div class="uk-margin">
                            <input id="signUpPasswordEnsure" class="uk-input" type="password" placeholder="确认密码"/>
                        </div>
                        <div class="uk-margin">
                            <h3>我...</h3>
                            <div class="uk-margin">
                                <label><input class="uk-radio" type="radio" name="role" checked="checked" value="p"/> 技术好，想拍别人</label>
                            </div>
                            <div class="uk-margin">
                                <label class="uk-margin"><input class="uk-radio" type="radio" name="role" value="m"/> 长的好看，想被拍</label>
                            </div>
                        </div>
                        <button id="signUpBtn" class="uk-form-width-medium uk-button-default uk-button">注册</button>
                        <div class="uk-margin">
                            回到<a id="toSignInLink">登录</a>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
    </body>
    <script>
        $('document').ready(function () {
            let imgPathArr = ['../imgs/index/bg1.jpg',
                '../imgs/index/bg2.jpg',
                '../imgs/index/bg3.jpg',
                '../imgs/index/bg4.jpg',
                '../imgs/index/bg5.jpg',
                '../imgs/index/bg6.jpg'];
            let liArr = $('.uk-dotnav li');

            let counter = 0;    

            let timer = setInterval(function () {
                changeBgImg(counter);
            }, 5000);

            $.each($('.uk-dotnav li a'), function (index, element) {
                $(this).mouseover(function () {
                    clearInterval(timer);
                    changeBgImg(index - 1);
                    timer = setInterval(function () {
                        changeBgImg(counter);
                    }, 5000);
                });
            });

            function changeBgImg(index) {
                liArr[counter].className = '';
                counter = index;
                counter++;
                if (counter >= imgPathArr.length) {
                    counter = 0;
                }
                $('body').css('background-image', `url(${imgPathArr[counter]})`);
                liArr[counter].className = 'uk-active';
            }

            $('#signInBtn').click(function () {
                let username = $('#signInUsername').val();
                let password = $('#signInPassword').val();
                if (username === ''){
                    notification('未输入用户名！','danger');
                }
                else if(password === ''){
                    notification('未输入密码！','danger');
                }
                else {
                    $.ajax({
                        type: 'POST',
                        url: 'php/SignIn.php',
                        dataType: 'json',
                        data: {
                            'username': username,
                            'password': password
                        },
                        success: function (data) {
                            if(data.code === 200){
                                window.location.href = 'html/today.html';
                                setCookie('user_name', username);
                            }
                            else {
                                notification(data.msg, 'danger');
                            }
                        },
                        error: function (code) {
                            console.log(code);
                        }
                    });
                }
                return false;
            });

            $('#signUpBtn').click(function () {
                let username = $('#signUpUsername').val();
                let phone = $('#signUpPhone').val();
                let nickname = $('#signUpNickname').val();
                let password = $('#signUpPassword').val();
                let passwordEnsure = $('#signUpPasswordEnsure').val();
                if (username === ''){
                    notification("用户名不能为空!", 'danger');
                }
                else if(username.length < 6 || username.length > 14){
                    notification("用户名长度需在6~14个字符之间!", 'danger');
                }
                else if(phone === ''){
                    notification("手机号不能为空!",'danger');
                }
                else if(phone.length !== 11){
                    notification("无效的手机号!",'danger');
                }
                else if(nickname === ''){
                    notification("昵称不能为空!",'danger');
                }
                else if(nickname.length < 1 || nickname.length > 12){
                    notification("昵称长度需在1~12个字符之间!",'danger');
                }
                else if(password === ''){
                    notification("密码不能为空!",'danger');
                }
                else if(!(password === passwordEnsure)){
                    notification("两次输入密码不一致!",'danger');
                }
                else {
                    $.ajax({
                        type: 'POST',
                        url: 'php/SignUp.php',
                        dataType:'json',
                        data: {
                            'username': username,
                            'password': password,
                            'phone': phone,
                            'nickname': nickname,
                            'role': $('input[name="role"][checked]').val(),
                        },
                        success: function (data) {
                            if (data.code === 200) {
                                notification(data.msg, 'success');
                                setTimeout(function () {
                                    window.location.href = 'html/today.html';
                                },2000);
                            }
                            else{
                                notification(data.msg,'danger');
                            }
                        },
                        error: function (code) {
                            console.log(code);
                        }
                    });
                }
                return false;
            });

            $('#signUpForm').hide();

            $('#toSignUpLink').click(function () {
                $('#signInForm').hide(500);
                $('#signUpForm').show(500);
            });

            $('#toSignInLink').click(function () {
                $('#signInForm').show(500);
                $('#signUpForm').hide(500);
            });



        });

    </script>
</html>